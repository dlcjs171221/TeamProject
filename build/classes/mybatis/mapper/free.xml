<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="free">

<resultMap type="mybatis.vo.FreeVO" id="map1">
	<id property="f_idx" column="f_idx"/>
	<collection property="f_list" ofType="mybatis.vo.FCommVO"
		column="f_idx" select="fcommlist"/>
</resultMap>


<!-- 특정 원글들의 기본키를 조건으로 하여
		해당 댓글들을 조회하는 기능 -->
<select id="fcommlist" resultType="mybatis.vo.FCommVO"
	parameterType="String">
		select * from fcomment_t
		where f_idx = #{f_idx}
	</select>



<!-- 사용자가 원글의 목록을 만들기 위해 호출하는 기능 -->
<select id="freelist" parameterType="java.util.Map"
resultMap="map1">
	SELECT * FROM(
			SELECT rownum r_num, a.* FROM(
				SELECT * FROM free_t
				WHERE status = 0
				ORDER BY f_idx DESC
			) a
		) WHERE r_num BETWEEN #{begin} AND #{end}
		
</select>


<!-- 전체 게시물 수 -->
<select id="totalCount" resultType="int">
	select count(*) from free_t
	where status = 0
</select>

<!-- 원글 저장하는 기능(추가) -->
<insert id="add" parameterType="java.util.Map">
	insert into free_t(f_idx, subject, writer, content, file_name, 
			ori_name, pwd, write_date, ip, hit, status)
		values(free_t_seq.nextval, #{subject}, #{writer}, #{content}, #{file_name}, 
			#{ori_name}, #{pwd}, sysdate, #{ip}, #{hit}, #{status})
</insert>

<!-- 보기 기능 :
		기본키(b_idx)를 인자로 받아 조건으로 부여하여 
		원글을 검색한다. -->
	<select id="getFree" parameterType="String"
	resultMap="map1">
		select * from free_t
		where f_idx = #{f_idx}
	</select>
	
<!-- 댓글 저장하는 기능 -->
	<insert id="add_ans" parameterType="mybatis.vo.FCommVO">
		insert into fcomment_t(c_idx, writer, content, pwd, write_date,
			ip, f_idx)
		values(fcomment_t_seq.nextval, #{writer}, #{content}, #{pwd}, sysdate, 
		#{ip}, #{f_idx})
	</insert>
	
<!-- 원글 수정 -->
	<update id="edit" parameterType="java.util.Map">
		update free_t
		set subject = #{subject},
			writer = #{writer},
			ip = #{ip},
			content = #{content}
			<if test="fname != null">
			,file_name = #{f_name}
			,ori_name = #{o_name}
			</if>
			where f_idx = #{f_idx} and pwd =#{pwd}
	</update>

<!-- 원글 삭제 -->
	<update id="del" parameterType="java.util.Map">
		update free_t
		set 
			status = 1
		where f_idx = #{f_idx} and pwd =#{pwd}
		
	</update>	

<!-- 조회수 증가 -->
	<update id="hit" parameterType="String">
		update free_t
		set hit = hit+1
		where f_idx = #{f_idx}
	</update>


</mapper>